# README
IMAS IDS Validator is a tool to validate IMAS IDS's through the use of general
and case specific validation rules.

# Set up your environment
Setup a project folder and clone git repository
```bash
mkdir projects
cd projects
git clone ssh://git@git.iter.org/imex/ids-validator.git
cd ids-validator
```

Setup a python virtual environment and install python dependencies
```bash
python3 -m venv ./venv
. venv/bin/activate
pip install --upgrade pip
pip install --upgrade wheel setuptools
pip install .
# For development an installation in editable mode may be more convenient
# pip install .[all]
```

Install IMASPy.
If on ITER cluster and Eurousion gateway:

```bash
module load IMAS IMASPy
```

If local see [IMASPy installation docs](https://git.iter.org/projects/IMAS/repos/imaspy/browse/docs/source/installing.rst).

Test the installation

```bash
python3 -c "import imaspy; print(imaspy.__version__)"
pytest
```

# Documentation
Documentation is autogenerated from the source using [Sphinx](http://sphinx-doc.org/)
and can be found at the [ITER sharepoint](https://sharepoint.iter.org/departments/POP/CM/IMDesign/Code%20Documentation/ids-validator-doc/index.html)

The documentation can be manually generated by installing sphinx and running:

```bash
make -C docs html
```

# Examples
```
@validator("*")
def validate_ids_common(ids):
  assert Exists(
    ids.ids_properties.comment,
    ids.ids_properties.source,
    ids.ids_properties.provider,
  )
  if hasattr(ids, "time"):
    assert ids.time == Increasing()
        
@validator("*", min_dd_version="3.39.0")
def validate_ids_plugins_metadata(ids):
  plugins = ids.ids_properties.plugins
  assert plugins.node[:].path != ""
  assert plugins.node[:].put_operation[:].name != ""
  # etc.

@validator("gyrokinetics")
def validate_gyrokinetics_electron_definition(gk):
  # check electron definition
  for species in gk.species:
    if species.charge_norm != -1:
      continue
    assert Approx(species.mass_norm, 2.724437108e-4, rtol=1e-5, atol=1e-8)
    assert species.temperature_norm == 1.0
    assert species.density_norm == 1.0
    break
  else:
    error("No electron species found", gk.species)`
```
